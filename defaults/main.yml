---
# defaults file for ansible-role-forgejo

# Forgejo version and installation settings
forgejo_target_version: "12.0.3"
forgejo_install_path: "/usr/local/bin"  # Installation directory for the forgejo binary
forgejo_os: "linux"  # Currently only linux binaries are available
forgejo_arch: "amd64"  # Options: amd64, arm64

# Git user configuration for Forgejo service
forgejo_user: "git"  # Username for Forgejo service
forgejo_group: "git"  # Group name for Forgejo service
forgejo_home: "/home/git"  # Home directory for git user
forgejo_shell: "/bin/bash"  # Shell for git user

# Forgejo directory configuration
forgejo_data_path: "/var/lib/forgejo"  # Data directory for repositories and application data
forgejo_config_path: "/etc/forgejo"  # Configuration directory for app.ini and other config files

# Database configuration
forgejo_database_type: "sqlite3"  # Options: sqlite3, mysql, postgres
forgejo_database_host: "localhost"
forgejo_database_port: 3306  # Default MySQL port
forgejo_database_name: "forgejo"
forgejo_database_user: "forgejo"
forgejo_database_password: ""  # Should be provided via vault
forgejo_database_path: "{{ forgejo_data_path }}/forgejo.db"  # For SQLite
forgejo_database_ssl_mode: "disable"  # For PostgreSQL

# Server configuration
forgejo_server_protocol: "http"  # Options: http, https
forgejo_server_domain: "localhost"
forgejo_server_http_addr: "0.0.0.0"
forgejo_server_http_port: 3000
forgejo_server_root_url: "http://localhost:3000/"
forgejo_server_disable_ssh: false
forgejo_server_ssh_domain: "{{ forgejo_server_domain }}"
forgejo_server_ssh_port: 22
forgejo_server_ssh_listen_port: 2222
forgejo_server_lfs_start_server: true
forgejo_server_enable_gzip: false
forgejo_server_landing_page: "home"  # Options: home, explore, organizations, login

# Repository configuration
forgejo_repository_root: "{{ forgejo_data_path }}/repositories"  # Root path for storing repositories
forgejo_repository_default_private: "last"  # Options: last, true, false
forgejo_repository_default_branch: "main"  # Default branch name for new repositories
forgejo_repository_disable_http_git: false  # Disable HTTP Git protocol
forgejo_repository_upload_file_max_size: 4095  # Max file size in MB
forgejo_repository_upload_max_files: 20

# Security configuration
forgejo_security_install_lock: true  # Disable installer after setup
# SECRET_KEY and INTERNAL_TOKEN are auto-generated by Forgejo on first run if empty
# You can provide your own values for consistent deployments across multiple instances
forgejo_security_secret_key: ""  # Auto-generated if empty (used for encryption - IMPORTANT to backup)
forgejo_security_internal_token: ""  # Auto-generated if empty (used for internal API calls)
forgejo_security_min_password_length: 6  # Minimum password length
forgejo_security_disable_git_hooks: true  # Prevent custom Git hooks for security

# Service configuration
forgejo_service_disable_registration: false
forgejo_service_require_signin_view: false
forgejo_service_register_email_confirm: false
forgejo_service_enable_captcha: false  # Enable registration captcha
forgejo_service_default_user_visibility: "public"  # Options: public, limited, private
forgejo_service_enable_notify_mail: true
forgejo_service_default_keep_email_private: false
forgejo_service_default_allow_create_organization: true
forgejo_service_default_enable_timetracking: true
forgejo_service_no_reply_address: "noreply.{{ forgejo_server_domain }}"

# Mailer configuration
forgejo_mailer_enabled: false
forgejo_mailer_protocol: "sendmail"  # Options: sendmail, smtp
forgejo_mailer_smtp_addr: ""
forgejo_mailer_smtp_port: 587
forgejo_mailer_user: ""
forgejo_mailer_passwd: ""
forgejo_mailer_from: "Forgejo <noreply@{{ forgejo_server_domain }}>"

# Cache configuration
forgejo_cache_adapter: "memory"  # Options: memory, redis, memcache
forgejo_cache_host: ""  # For redis/memcache, format: "network=tcp,addr=:6379,db=0,pool_size=100,idle_timeout=180"
forgejo_cache_item_ttl: "16h"  # Cache item time-to-live

# Session configuration
forgejo_session_provider: "file"  # Options: file, memory, redis, mysql, postgres
forgejo_session_cookie_name: "i_like_forgejo"  # Session cookie name
forgejo_session_session_life_time: 86400  # Session duration in seconds (default: 24 hours)
forgejo_session_gc_interval: 86400  # Session garbage collection interval
forgejo_session_same_site: "lax"  # Options: lax, strict, none

# Picture configuration
forgejo_picture_gravatar_source: "gravatar"  # Options: gravatar, libravatar
forgejo_picture_disable_gravatar: false  # Disable Gravatar
forgejo_picture_enable_federated_avatar: false  # Enable federated avatars

# Attachment configuration
forgejo_attachment_enabled: true  # Enable attachments
# Allowed file extensions for attachments (comma-separated list)
forgejo_attachment_allowed_types: >-
  .csv,.docx,.fodg,.fodp,.fods,.fodt,.gif,.gz,.jpeg,.jpg,.log,.md,.mov,.mp4,
  .odf,.odg,.odp,.ods,.odt,.patch,.pdf,.png,.pptx,.svg,.tgz,.txt,.webm,.xls,.xlsx,.zip
forgejo_attachment_max_size: 4  # Maximum attachment size in MB
forgejo_attachment_max_files: 5  # Maximum number of attachments per issue/PR

# Log configuration
forgejo_log_mode: "console"  # Options: console, file, conn, smtp
forgejo_log_level: "Info"  # Options: Trace, Debug, Info, Warn, Error, Critical
forgejo_log_router: "console"  # Router log mode
forgejo_log_enable_access_log: false  # Enable access logging
# Access log template format (uses Go template syntax for Forgejo, wrapped in raw block to avoid Jinja2 processing)
forgejo_log_access_log_template: ""  # Use default Apache combined log format

# Git timeout configuration (in seconds)
forgejo_git_timeout_default: 3600
forgejo_git_timeout_migrate: 6000
forgejo_git_timeout_mirror: 3000
forgejo_git_timeout_clone: 300
forgejo_git_timeout_pull: 300
forgejo_git_timeout_gc: 60

# Systemd service configuration
forgejo_service_enabled: true  # Enable and start systemd service
forgejo_service_description: "Forgejo (Beyond coding. We forge.)"  # Service description
forgejo_service_restart_sec: "2s"  # Restart delay after failure
forgejo_service_enable_capabilities: false  # Enable CAP_NET_BIND_SERVICE for low ports
